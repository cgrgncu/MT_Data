# 時間序列資料格式研究

### 時間序列檔案格式規格書
+ DAA09 - DataFormat 3rd Party v2.0 - 210915.pdf

### 相容硬體型號  
+ MTU-8A 
+ RXU-8A
+ MTU-5C
+ MTU-2C
+ MTU-5D
+ 其他延伸產品
  
### 相容軟體/韌體版本
+ v2.0以上版本

### 原生取樣率  
+ MTU-8A : 24K[SPS]
+ RXU-8A : 24K[SPS]
+ MTU-5C : 24K[SPS]
+ MTU-2C : 24K[SPS]
+ MTU-5D : 96K[SPS]

### SD卡中的存放位置
+ 「recdata」資料夾中
+ 「recdata」資料夾中每次連續紀錄會建立一個獨一無二的資料夾，命名方式如下:
  + XXXXX_YYYY-MM-DD-HHNNSS，例如: 12345_2016-04-29-202957 。
  + XXXXX為五個數字，代表儀器序號，例如: 12345 。
  + YYYY-MM-DD為記錄起始時間年月日，來自GPS時間(UTC+潤秒)。其中YYYY為西元年(四碼)，MM為月(兩碼)，DD為日(兩碼)。
  + HHNNSS為記錄起始時間時分秒，來自GPS時間(UTC+潤秒)。其中HH為24制小時(兩碼)，NN為分(兩碼)，SS為秒(兩碼)。  
+ 該紀錄資料夾(例如「12345_2016-04-29-202957」資料夾)中會存在以下資料夾及檔案:
  + 由單純數字遞增的紀錄資料夾們，例如:「0」、「1」、「2」、「3」、「4」。通常是指:「H2(Hy)」、「E1(Ex)」、「H1(Hx)」、「H3(Hz)」、「E2(Ey)」。
  + 「backend.log」檔案: MTU主機開機後的主要運行工作紀錄檔案。
  + 「config.json」檔案: MTU主機開機後依照此設定檔案進行紀錄工作。檔案內容與野外操作前編輯好放入SD卡的檔案一致。
  + 「recmeta.json」檔案: 描述與記錄檔案有關的參數。由MTU主機運作時產出的檔案，內容若有變化可能與韌體版本有關。
  + 「recmeta.json.bak」檔案: 「recmeta.json」檔案的備份。可能EMpower會用到。
  + 「empower_recmeta.json」檔案: 這個檔案並不是必須存在，若存在表示給EMpower軟體使用。可能EMpower會將使用者參數的編輯與修正儲存在此檔案中而不會損毀原始的參數檔案，細節待確認。
  + 「stats」檔案: 儲存記錄檔案的統計資訊。目前是屬於實驗性的功能??
  + 「executor.log」檔案: 儲存運行中的特殊事件紀錄。

### 連續型時間序列資料格式(format of continuous time series)
+ 命名方式: AAAAA_BBBBBBBB_C_DDDDDDDD.bin
  + XXXXX為5個數字，代表儀器序號，例如: 12345 。
  + BBBBBBBB為8個英數字，為32位元無號數十六進制標籤，表示記錄開始時間的時間戳，與序列號一起構成記錄的唯一ID。
    + 這個時間戳是原廠自訂的格式，使用「UNIX時間(Unix-epoch)」的時間起點(UTC1970年1月1日0時0分0秒起)。但使用GPS時間標準而非UTC時間。這表示會與一般認知的UTC時間差距整數倍秒，可以理解這是因為儀器採用GPS時鐘，所以不轉換為UTC時間。 
    + 這個時間序列定義在舊版本(Time Series v4之前，對應儀器韌體版本v2.0之前)存在錯誤，其錯誤原因與GPS晶片硬體及驅動有關，紀錄時間將落後GPS時間1秒。在後續的版本已經修正此問題。因為此文件也是針對韌體版本v2.0以後版本描述，所以我只針對後續版本測試。
      ```
      + 協調世界時間，UTC（Coordinated Universal Time）：
        + 它是最主要的世界時間標準，基於國際原子時鐘，並通過不規則的加入閏秒來抵消地球自轉變慢的影響。
        + 它又稱為世界統一時間、世界標準時間、國際協調時間。由於英文（CUT）和法文（TUC）的縮寫不同，作為妥協，簡稱UTC。
        + 協調世界時間（UTC）是世界上調節時鐘和時間的主要時間標準，是最接近格林威治標準時間（GMT）的幾個替代時間系統之一。
        + 對於大多數用途來說，UTC時間被認為能與GMT時間互換。
        + 人們對該時間系統進行過數次調整，直到1972年引入了閏秒機制，調整工作得以簡化。
      + Unix或POSIX時間戳：
        + 它是UNIX或類UNIX系統使用的時間表示方式。
        + 一般定義為從協調世界時(UTC時間)1970年1月1日0時0分0秒起至現在的總秒數（10位是精確到秒，13位是精確到毫秒）。
        + 考慮到閏秒的話，更精確的定義為從協調世界時(UTC時間)1970年1月1日0時0分0秒起至現在經過閏秒調整之後的總秒數
      + GPS時間：
        + 它是GPS原子時鐘，它的時間基準是1980年1月6日0時0分0秒與世界協調時刻UTC相一致，以後按原子時鐘秒長累積計時。
        + GPS時間不做潤秒調整。GPS時間跟UTC時間之差為秒的整倍數。例如：1989年為5秒，1996年為11秒，2002年為13秒，到現在2020年08月為止為18秒。
      ```
  + C為1個數字，做為頻道代號ID，從0開始。與所在紀錄資料夾相同數字，例如:「0」、「1」、「2」、「3」、「4」。通常是指:「H2(Hy)」、「E1(Ex)」、「H1(Hx)」、「H3(Hz)」、「E2(Ey)」。
  + DDDDDDDD為8個英數字，為32位元無號數十六進制標籤，紀錄器每一段時間將資料儲存為一個檔案，此標籤為該檔案的索引。每個檔案每分鐘都在儲存一次，此索引值的極限設計為可以儲存8100年的連續數據。目前儲存每分鐘一次這個週期是固定的，未來可能改動為可以規劃設定的。
  
